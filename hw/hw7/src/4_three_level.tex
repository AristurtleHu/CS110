
The system employs a 48-bit virtual address space with byte-addressable memory, using 4KB pages and 32-bit page table entries (PTEs) where 8 bits are reserved for protection and valid flags. The address translation uses a three-level page table hierarchy. Each of the three page table index fields is 10 bits.

\begin{parts}
    \part [4] Given the virtual address $\mathtt{0x3456789ABC}$. Suppose the contents of the page table entries of the three-level page table are as follows:
    \begin{itemize}[leftmargin=*]
        \item The base address of the first-level page table is $\mathtt{0x1000}$.
        \item The base address of the second-level page table is $\mathtt{0x2000}$.
        \item The base address of the third-level page table is $\mathtt{0x3000}$, and the PTE with index 3 points to the Physical Page Frame (PPN) $\mathtt{0x4000}$. [4 points]
    \end{itemize}
    \vspace{0.5cm}
    Final physical address:\blank[3cm]{0x4ABC}.
    \vspace{0.5cm}

    \part[4] Calculate the total size of all second-level page tables. [4 points]

    Each second-level page table has $2^{10}$ entries, and each entry is 8 bytes. Therefore, the size of each second-level page table is:
    \begin{equation*}
        2^{10} \text{ entries} \times 8 \text{ bytes/entry} = 8 \text{ KB}
    \end{equation*}

    Since there are $2^{10}$ second-level page tables, the total size is:
    \begin{equation*}
        2^{10} \text{ tables} \times 8 \text{ KB/table} = 8 \text{ MB}
    \end{equation*}

    \part[4] Consider an x86-64 system with 64-bit virtual addressing (48-bit usable), 4KB page tables, and 8-byte PTEs, supporting both 4KB pages (4-level: PML4$\to$PDPT$\to$PD$\to$PT) and 2MB huge pages (3-level, no PT). When using 2MB huge pages for application data, how is the virtual address partitioned?  \textbf{Specify bit allocations for PML4, PDPT, PD indices and page offset as [high:low] ranges using zero-based indexing}. [4 points]

    \begin{equation*}
        (48 - 21) / 3 = 9
    \end{equation*}

    \begin{itemize}
        \item PML4 index: [47:39] (9 bits)
        \item PDPT index: [38:30] (9 bits)
        \item PD index: [29:21] (9 bits)
        \item Page offset: [20:0] ($2^{21} = 2\text{MB}$)
    \end{itemize}

\end{parts}
